
$(document).ready(function() {
    $(".open-popup").click(function() {
        var p = $(this).attr("href");
        return $(".popup-window").fadeOut(321), $("#popup-wrapper").fadeIn(321), $(p).fadeIn(321), !1
    }), $(".close-popup, #mask").click(function(e) {
        return $(".popup-window, #popup-wrapper").fadeOut(321), !1
    });


    $('.js-form-validate').submit(function(e) {

        $('.error').remove();

        var fio = /([А-ЯЁ][а-яё]+[\-\s]?){2,}/.test($(this).find('input[name=fio]').val());
        var email = /^([a-z0-9_\.-]+)@([a-z0-9_\.-]+)\.([a-z\.]{2,6})$/.test($(this).find('input[name=email]').val());
        var password = /^[a-z0-9]{6,}$/.test($(this).find('input[name=password]').val());
        var oldPassword = /^[a-z0-9]{6,}$/.test($(this).find('input[name=oldpassword]').val());
        var repeatPassword = /^[a-z0-9]{6,}$/.test($(this).find('input[name=repeatpassword]').val());

        if (!$(this).find('input[name=fio]'))
            fio = true;
        if (!$(this).find('input[name=email]'))
            email = true;
        if (!$(this).find('input[name=password]'))
            password = true;
        if (!$(this).find('input[name=oldpassword]'))
            oldPassword = true;
        if (!$(this).find('input[name=repeatassword]'))
            repeatPassword = true;

        // Позиция сообщения об ошибке - сверху/снизу
        if ($('body').innerHeight() - $(this).offset().top <= 100)
            var error = 'error error_top';
        else
            var error = 'error';

        $(this).find('input[required]').each(function(index, element){
            var name = element.getAttribute('name');

            if (name == 'fio' && !fio)
                $(this).after("<div class='" +error+ "'><i></i><span>ФИО должно состоять из Фамилии, Имени и Отчества</span></div>");
            if (name == 'email' && !email)
                $(this).after("<div class='" +error+ "'><i></i><span>Проверьте правильность e-mail</span></div>");
            if ((name == 'password' && !password) ||
                (name == 'oldpassword' && !oldPassword) ||
                (name == 'repeatpassword' && !repeatPassword) )
                $(this).after("<div class='" +error+ "'><i></i><span>Пароль должен состоять из 6 и более символов</span></div>");
        });

        if ( (password && repeatPassword) && 
             ($(this).find('.error').length == 0) &&
             ($(this).find('input[name=password]').val() !== $(this).find('input[name=repeatpassword]').val()) ) {
            $(this).find('input[name=repeatpassword]').after("<div class='" +error+ "'><i></i><span>Введённые пароли не совпадают!</span></div>");
        }

        if ( $(this).find('.error').length > 0 ) {
            $(this).find('.error:eq(0)').fadeIn(321);
            return false;
        }

        return;
    });

    $('.js-form-validate').on('keypress keyup', function() {
        $('.error').remove();
    });
  })
