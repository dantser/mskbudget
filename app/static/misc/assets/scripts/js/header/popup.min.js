
$(document).ready(function() {
    $(".open-popup").click(function() {
        var p = $(this).attr("href");
        return $(".popup-window").fadeOut(321), $("#popup-wrapper").fadeIn(321), $(p).fadeIn(321), !1
    }), $(".close-popup, #mask").click(function(e) {
        return $(".popup-window, #popup-wrapper").fadeOut(321), !1
    });

    $('.login-form input').on('keypress keydown keyup', function() {
        if ($('.login-form input').val()) {
            $('.overlabel').hide();
        } else {
            $('.overlabel').show();
        }
    })

    $('.login-form_reg input').on('keypress keydown keyup', function() {
        if ($('.login-form_reg input').val()) {
            $('.login-form_reg .overlabel').hide();
        } else {
            $('.login-form_reg .overlabel').show();
        }
    })

    $('.login-form__submit').on('click', function(e) {
        var $this = $(this);
        var top = $('#reset .popup-restore__top');
        var bottom = $('#reset .popup-restore__p');

        if ($this.val() == 'Войти') {
          return
        } else if ($this.val() == 'Отправить') {
            top.text('Запрос на сброс пароля');
            bottom.text('На ваш мейл выслано письмо со ссылкой для сброса пароля')
            return $(".popup-window").fadeOut(321),$("#popup-wrapper").fadeIn(321), $("#reset").fadeIn(321),!1
        }
    })

    var validator = $('.login-form_reg').validate({
        onfocusout: false,
        onkeyup: false,
        onclick: false,
        rules: {
            ifio1: {
                required: true,
                fio: true
            },
            iemail3: {
                required: true,
                email: true
            },
            ipassw1: {
                required: true,
                password: true
            },
        },
        messages: {
            ifio1: {
                required: 'Введите ФИО',
                fio: 'ФИО введено неверно'
            },
            iemail3: {
                required: 'Введите адрес электронной почты',
                email: 'Адрес электронной почты введен неверно'
            },
            ipassw1: {
                required: 'Введите пароль',
                password: 'Пароль должен содержать минимум 8 символов, латинские буквы, минимум одну прописную букву и одну цифру'
            },
        },

        submitHandler: function(form) {
            var top = $('#reset .popup-restore__top');
            var bottom = $('#reset .popup-restore__p');
            top.text('Регистрация успешна!');
            bottom.text('На ваш мейл выслано письмо для подтверждения регистрации');
            $(".popup-window").fadeOut(321),$("#popup-wrapper").fadeIn(321), $("#reset").fadeIn(321)
            setTimeout(function(){
                form.submit();
            }, 3000);
            
        },
        showErrors: function(errorMap, errorList) { // Показать только первую ошибку
                if (errorList.length) {
                     var s = errorList.shift();
                     var n = [];
                     n.push(s);
                     this.errorList = n;
                }
                this.defaultShowErrors();
        },
    });

    $('.login-form_reg').click(function() {
        validator.resetForm();
    });

    $.validator.addMethod('fio', function(value, element) {
        var fio = /([А-ЯЁ][а-яё]+[\-\s]?){3,}/.test($('#i-fio-1').val());
        return fio;
    }, 'Wrong name format');

    $.validator.addMethod('password', function(value, element) {
        var password = /(?=^.{8,}$)((?=.*\d)|(?=.*\W+))(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$/.test($('#i-passw-1').val());
        return password;
    }, 'Wrong password format');

  })
